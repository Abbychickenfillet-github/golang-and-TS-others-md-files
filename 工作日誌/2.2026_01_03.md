# 工作日誌 2026-01-03

## 任務：移除 outlet_specification 表，遷移至 product 表

### 背景
發現插座規格也算是 product，沒必要建立專屬的表。決定將 `outlet_specification` 資料遷移至 `product` 表。

### 遷移分析

#### 當前 outlet_specification 資料（5 筆）
| name | socket_type | price_type | price |
|------|-------------|------------|-------|
| 三孔延長線 3m | extension | deposit | 200 |
| 標準二孔壁插 | 2pin | free | 0 |
| 標準三孔壁插 | 3pin | free | 0 |
| 三孔延長線 5m | extension | deposit | 300 |
| 工業級延長線 10m | extension | purchase | 850 |

#### 欄位對應
- `company_id` → `provider_company_id`
- `price_type` → `purchase_type`（free/deposit → rent, purchase → purchase）
- `socket_type`, `outlet_count`, `is_extension`, `cable_length_cm` → `specifications` (JSON)
- `product_type_id` = `dda88af5-0ee1-44a5-93d9-45f84468e5f2`（插座）

#### electricity_calculation_rule 關聯
- `included_outlet_id` 改為 `included_product_id`
- 2 筆規則成功遷移

---

## 實作步驟（已完成）

### Phase 1: 資料庫遷移 ✅
- [x] 執行 SQL 遷移腳本 (`backend/sql/159_migrate_outlet_to_product.sql`)
- [x] 將 5 筆 outlet_specification 資料遷移到 product 表
- [x] 新增 `included_product_id` 欄位到 electricity_calculation_rule
- [x] 遷移 `included_outlet_id` 資料到 `included_product_id`
- [x] 移除 `included_outlet_id` 欄位
- [x] 備份 outlet_specification 表為 outlet_specification_backup

### Phase 2: 後端程式碼修改 ✅
- [x] 刪除 `backend/app/models/outlet_specification.py`
- [x] 刪除 `backend/app/crud/outlet_specification.py`
- [x] 刪除 `backend/app/api/routes/outlet_specification.py`
- [x] 更新 `backend/app/models/__init__.py`（移除 OutletSpecification imports）
- [x] 更新 `backend/app/crud/__init__.py`（移除 outlet_specification_crud）
- [x] 更新 `backend/app/api/main.py`（移除 outlet_specification router）
- [x] 更新 `backend/app/models/company.py`（移除 outlet_specifications 關聯）
- [x] 更新 `backend/app/models/general_contractor.py`（included_outlet → included_product）

### Phase 3: 前端程式碼修改 ✅
- [x] 刪除 `frontend/src/routes/_layout/outlet-specifications.tsx`
- [x] 刪除 `frontend/src/client/models/outlet-specification.ts`
- [x] 更新 `frontend/src/components/Common/SidebarItems.tsx`（移除插座規格選單項目）
- [x] 更新 `frontend/src/routes/_layout/order-electricity.tsx`
  - 新增 OutletProduct 介面和 convertProductToOutlet 轉換函數
  - API 呼叫改為 `/api/v1/products/all?product_type_id=插座`
  - 更新所有 `included_outlet_id` → `included_product_id`
  - 更新提示訊息（插座規格管理 → 商品與分類）
- [x] 重新生成路由檔案（routeTree.gen.ts）
- [x] TypeScript 編譯通過

### Phase 4: 清理 ✅
- [x] outlet_specification 表已備份為 outlet_specification_backup（建議 30 天後刪除）

---

## 新增檔案
- `backend/sql/159_migrate_outlet_to_product.sql`

## 刪除檔案
- `backend/app/models/outlet_specification.py`
- `backend/app/crud/outlet_specification.py`
- `backend/app/api/routes/outlet_specification.py`
- `frontend/src/routes/_layout/outlet-specifications.tsx`
- `frontend/src/client/models/outlet-specification.ts`

## 修改檔案
- `backend/app/models/__init__.py`
- `backend/app/crud/__init__.py`
- `backend/app/api/main.py`
- `backend/app/models/company.py`
- `backend/app/models/general_contractor.py`
- `frontend/src/components/Common/SidebarItems.tsx`
- `frontend/src/routes/_layout/order-electricity.tsx`

---

## 其他今日完成事項

- [x] 修復 .env 加入 .gitignore
- [x] 攤位通關密碼新增顯示/隱藏切換功能
- [x] 防止瀏覽器自動填入通關密碼（autoComplete="off"）
- [x] Merge develop 到 feat/order-items-management-page
- [x] 創建 logging.md 學習筆記
